generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model customer_bank_accounts {
  bank_account_id String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  customer_id     String    @db.Uuid
  bank_name       String?   @db.VarChar(255)
  account_name    String?   @db.VarChar(255)
  account_number  String?   @db.VarChar(255)
  created_at      DateTime? @default(now()) @db.Timestamptz(6)
  customers       customers @relation(fields: [customer_id], references: [customer_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_bank_customer")
}

model customer_heirs {
  customer_heir_id String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  customer_id      String    @db.Uuid
  full_name        String?
  cnic             String?
  phone_number     String?
  created_at       DateTime? @default(now()) @db.Timestamptz(6)
  customers        customers @relation(fields: [customer_id], references: [customer_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_heir_customer")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model customers {
  customer_id                       String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id                           String                   @db.Uuid
  contact_number                    String?                  @db.VarChar(30)
  city                              String?                  @db.VarChar(100)
  address                           String?
  cnic                              String?                  @db.VarChar(20)
  status                            String                   @default("active") @db.VarChar(30)
  created_by                        String                   @db.Uuid
  created_at                        DateTime                 @default(now()) @db.Timestamptz(6)
  updated_at                        DateTime                 @default(now()) @db.Timestamptz(6)
  phone_number                      String?                  @db.VarChar(255)
  bank_name                         String?                  @db.VarChar(100)
  account_name                      String?                  @db.VarChar(255)
  account_number                    String?                  @db.VarChar(50)
  marketer_id                       String?                  @db.Uuid
  customer_bank_accounts            customer_bank_accounts[]
  customer_heirs                    customer_heirs[]
  users_customers_created_byTousers users                    @relation("customers_created_byTousers", fields: [created_by], references: [user_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_customer_created_by")
  users_customers_user_idTousers    users                    @relation("customers_user_idTousers", fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_customer_user")
  marketers                         marketers?               @relation(fields: [marketer_id], references: [marketer_id], onUpdate: NoAction, map: "fk_customers_marketer")
  smd_closings                      smd_closings[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model marketer_commissions {
  commission_id String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  marketer_id   String    @db.Uuid
  smd_id        String    @db.Uuid
  amount        Decimal   @db.Decimal(12, 2)
  month         DateTime  @db.Date
  status        String?   @default("pending") @db.VarChar(50)
  created_at    DateTime  @default(now()) @db.Timestamptz(6)
  marketers     marketers @relation(fields: [marketer_id], references: [marketer_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_commission_marketer")
  smds          smds      @relation(fields: [smd_id], references: [smd_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_commission_smd")
}

model marketers {
  marketer_id                       String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id                           String                 @db.Uuid
  commission_type                   String?                @default("percentage") @db.VarChar(20)
  commission_value                  Decimal                @db.Decimal(10, 2)
  status                            String?                @default("active") @db.VarChar(50)
  created_by                        String                 @db.Uuid
  created_at                        DateTime               @default(now()) @db.Timestamptz(6)
  customers                         customers[]
  marketer_commissions              marketer_commissions[]
  users_marketers_created_byTousers users                  @relation("marketers_created_byTousers", fields: [created_by], references: [user_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_marketer_created_by")
  users_marketers_user_idTousers    users                  @relation("marketers_user_idTousers", fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_marketer_user")
  smd_closings                      smd_closings[]
  smds                              smds[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model otps {
  otp_id       String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email        String    @db.VarChar(255)
  otp          String    @db.VarChar(10)
  purpose      String    @db.VarChar(50)
  expires_at   DateTime  @db.Timestamptz(6)
  resend_count Int       @default(0)
  attempts     Int       @default(0)
  last_sent    DateTime  @default(now()) @db.Timestamptz(6)
  block_until  DateTime? @db.Timestamptz(6)
  created_at   DateTime  @default(now()) @db.Timestamptz(6)
}

model roles {
  role_id     String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  role_name   String       @db.VarChar(50)
  description String?
  created_at  DateTime     @default(now()) @db.Timestamptz(6)
  user_roles  user_roles[]
  users       users[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model smd_closing_payments {
  payment_id     String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  smd_closing_id String       @db.Uuid
  amount         Decimal      @db.Decimal(14, 2)
  payment_date   DateTime     @default(now()) @db.Timestamp(6)
  payment_method String?      @db.VarChar(50)
  reference_no   String?      @db.VarChar(100)
  notes          String?
  recorded_by    String       @db.Uuid
  created_at     DateTime     @default(now()) @db.Timestamp(6)
  smd_closings   smd_closings @relation(fields: [smd_closing_id], references: [smd_closing_id], onDelete: Cascade, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model smd_closings {
  smd_closing_id       String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  smd_id               String                 @db.Uuid
  customer_id          String                 @db.Uuid
  marketer_id          String?                @db.Uuid
  sell_price           Decimal                @db.Decimal(14, 2)
  monthly_rent         Decimal                @db.Decimal(14, 2)
  status               String                 @default("active") @db.VarChar(30)
  closed_by            String                 @db.Uuid
  closed_at            DateTime               @default(now()) @db.Timestamp(6)
  created_at           DateTime               @default(now()) @db.Timestamp(6)
  updated_at           DateTime               @default(now()) @db.Timestamp(6)
  share_percentage     Decimal?               @default(100.00) @db.Decimal(5, 2)
  total_amount_due     Decimal                @default(0) @db.Decimal(14, 2)
  amount_paid          Decimal?               @default(0) @db.Decimal(14, 2)
  remaining_balance    Decimal?               @default(dbgenerated("(total_amount_due - amount_paid)")) @db.Decimal(14, 2)
  smd_closing_payments smd_closing_payments[]
  users                users                  @relation(fields: [closed_by], references: [user_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_closing_admin")
  customers            customers              @relation(fields: [customer_id], references: [customer_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_closing_customer")
  marketers            marketers?             @relation(fields: [marketer_id], references: [marketer_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_closing_marketer")
  smds                 smds                   @relation(fields: [smd_id], references: [smd_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_closing_smd")
  smd_rent_payouts     smd_rent_payouts[]
}

model smd_rent_payouts {
  payout_id      String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  smd_closing_id String       @db.Uuid
  payout_month   String       @db.VarChar(7)
  amount         Decimal      @db.Decimal(12, 2)
  status         String       @default("pending") @db.VarChar(30)
  paid_by        String?      @db.Uuid
  paid_at        DateTime?    @db.Timestamp(6)
  created_at     DateTime     @default(now()) @db.Timestamp(6)
  smd_closings   smd_closings @relation(fields: [smd_closing_id], references: [smd_closing_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_payout_closing")
  users          users?       @relation(fields: [paid_by], references: [user_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_payout_paid_by")

  @@index([smd_closing_id], map: "idx_payout_closing")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model smds {
  smd_id                          String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  owner_user_id                   String?                @db.Uuid
  added_by                        String                 @db.Uuid
  marketer_id                     String?                @db.Uuid
  smd_code                        String                 @db.VarChar(100)
  title                           String?                @db.VarChar(255)
  city                            String?                @db.VarChar(100)
  area                            String?                @db.VarChar(150)
  address                         String?
  latitude                        Decimal?               @db.Decimal(9, 6)
  longitude                       Decimal?               @db.Decimal(9, 6)
  purchase_price                  Decimal?               @db.Decimal(12, 2)
  monthly_payout                  Decimal?               @db.Decimal(12, 2)
  sell_price                      Decimal?               @db.Decimal(12, 2)
  status                          String?                @default("active") @db.VarChar(50)
  is_active                       Boolean?               @default(true)
  installed_at                    DateTime?              @db.Timestamptz(6)
  created_at                      DateTime               @default(now()) @db.Timestamptz(6)
  updated_at                      DateTime               @default(now()) @db.Timestamptz(6)
  marketer_commissions            marketer_commissions[]
  smd_closings                    smd_closings[]
  users_smds_added_byTousers      users                  @relation("smds_added_byTousers", fields: [added_by], references: [user_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_smd_added_by")
  marketers                       marketers?             @relation(fields: [marketer_id], references: [marketer_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_smd_marketer")
  users_smds_owner_user_idTousers users?                 @relation("smds_owner_user_idTousers", fields: [owner_user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_smd_owner")
}

model user_roles {
  user_id String @db.Uuid
  role_id String @db.Uuid
  roles   roles  @relation(fields: [role_id], references: [role_id], onDelete: Cascade, onUpdate: NoAction)
  users   users  @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)

  @@id([user_id, role_id])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model users {
  user_id                               String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email                                 String             @unique @db.VarChar(255)
  full_name                             String             @db.VarChar(255)
  password_hash                         String             @db.VarChar(255)
  avatar_url                            String?            @db.VarChar(500)
  role_id                               String             @db.Uuid
  last_login_at                         DateTime?          @db.Timestamptz(6)
  is_verified                           Boolean            @default(false)
  status                                String             @default("active") @db.VarChar(30)
  created_at                            DateTime           @default(now()) @db.Timestamptz(6)
  updated_at                            DateTime?          @default(now()) @db.Timestamptz(6)
  customers_customers_created_byTousers customers[]        @relation("customers_created_byTousers")
  customers_customers_user_idTousers    customers[]        @relation("customers_user_idTousers")
  marketers_marketers_created_byTousers marketers[]        @relation("marketers_created_byTousers")
  marketers_marketers_user_idTousers    marketers[]        @relation("marketers_user_idTousers")
  smd_closings                          smd_closings[]
  smd_rent_payouts                      smd_rent_payouts[]
  smds_smds_added_byTousers             smds[]             @relation("smds_added_byTousers")
  smds_smds_owner_user_idTousers        smds[]             @relation("smds_owner_user_idTousers")
  user_roles                            user_roles[]
  roles                                 roles              @relation(fields: [role_id], references: [role_id], onUpdate: NoAction, map: "fk_users_role")
}
